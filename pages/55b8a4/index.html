<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>事件循环 | comelong blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/boke/img/hero.jpg">
    <meta name="description" content="cometang前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,php,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="comelong个人博客,马金龙个人博客，前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/boke/assets/css/0.styles.dd81ba30.css" as="style"><link rel="preload" href="/boke/assets/js/app.c21ee17f.js" as="script"><link rel="preload" href="/boke/assets/js/2.befd470a.js" as="script"><link rel="preload" href="/boke/assets/js/84.54d34310.js" as="script"><link rel="prefetch" href="/boke/assets/js/10.c51b1a8d.js"><link rel="prefetch" href="/boke/assets/js/11.2c5ee6d1.js"><link rel="prefetch" href="/boke/assets/js/12.ff60574c.js"><link rel="prefetch" href="/boke/assets/js/13.6e556435.js"><link rel="prefetch" href="/boke/assets/js/14.1bceea12.js"><link rel="prefetch" href="/boke/assets/js/15.b7576ccb.js"><link rel="prefetch" href="/boke/assets/js/16.d62a39a3.js"><link rel="prefetch" href="/boke/assets/js/17.f2452aa0.js"><link rel="prefetch" href="/boke/assets/js/18.11020baa.js"><link rel="prefetch" href="/boke/assets/js/19.b30a2270.js"><link rel="prefetch" href="/boke/assets/js/20.f36898a6.js"><link rel="prefetch" href="/boke/assets/js/21.c4647ee1.js"><link rel="prefetch" href="/boke/assets/js/22.7111e078.js"><link rel="prefetch" href="/boke/assets/js/23.c13d1eb8.js"><link rel="prefetch" href="/boke/assets/js/24.80a48c23.js"><link rel="prefetch" href="/boke/assets/js/25.300ecb7d.js"><link rel="prefetch" href="/boke/assets/js/26.382754bf.js"><link rel="prefetch" href="/boke/assets/js/27.eecfb3b8.js"><link rel="prefetch" href="/boke/assets/js/28.24eea56e.js"><link rel="prefetch" href="/boke/assets/js/29.830a7d1f.js"><link rel="prefetch" href="/boke/assets/js/3.65d2c400.js"><link rel="prefetch" href="/boke/assets/js/30.99244ff0.js"><link rel="prefetch" href="/boke/assets/js/31.0b8ffbeb.js"><link rel="prefetch" href="/boke/assets/js/32.ce4cc53e.js"><link rel="prefetch" href="/boke/assets/js/33.7515c977.js"><link rel="prefetch" href="/boke/assets/js/34.fc41c42d.js"><link rel="prefetch" href="/boke/assets/js/35.1c3f79a9.js"><link rel="prefetch" href="/boke/assets/js/36.3ff9f305.js"><link rel="prefetch" href="/boke/assets/js/37.5e3fdc7e.js"><link rel="prefetch" href="/boke/assets/js/38.765264ae.js"><link rel="prefetch" href="/boke/assets/js/39.29c60cf7.js"><link rel="prefetch" href="/boke/assets/js/4.7b0dc363.js"><link rel="prefetch" href="/boke/assets/js/40.aa278266.js"><link rel="prefetch" href="/boke/assets/js/41.d26d178d.js"><link rel="prefetch" href="/boke/assets/js/42.3ca65b67.js"><link rel="prefetch" href="/boke/assets/js/43.4a8aab26.js"><link rel="prefetch" href="/boke/assets/js/44.65f4709f.js"><link rel="prefetch" href="/boke/assets/js/45.a404289b.js"><link rel="prefetch" href="/boke/assets/js/46.afa1a0af.js"><link rel="prefetch" href="/boke/assets/js/47.ce0255d3.js"><link rel="prefetch" href="/boke/assets/js/48.dee5f207.js"><link rel="prefetch" href="/boke/assets/js/49.26ec17ac.js"><link rel="prefetch" href="/boke/assets/js/5.6d04bdcf.js"><link rel="prefetch" href="/boke/assets/js/50.a7c07244.js"><link rel="prefetch" href="/boke/assets/js/51.9e978f40.js"><link rel="prefetch" href="/boke/assets/js/52.5de32d22.js"><link rel="prefetch" href="/boke/assets/js/53.f13917d8.js"><link rel="prefetch" href="/boke/assets/js/54.59d94dd1.js"><link rel="prefetch" href="/boke/assets/js/55.319e5de5.js"><link rel="prefetch" href="/boke/assets/js/56.07336cba.js"><link rel="prefetch" href="/boke/assets/js/57.af53568d.js"><link rel="prefetch" href="/boke/assets/js/58.715b44b9.js"><link rel="prefetch" href="/boke/assets/js/59.d4b1b15d.js"><link rel="prefetch" href="/boke/assets/js/6.77e49dd3.js"><link rel="prefetch" href="/boke/assets/js/60.6017290b.js"><link rel="prefetch" href="/boke/assets/js/61.daea4c59.js"><link rel="prefetch" href="/boke/assets/js/62.2d4d71d8.js"><link rel="prefetch" href="/boke/assets/js/63.e0264eef.js"><link rel="prefetch" href="/boke/assets/js/64.8d165a27.js"><link rel="prefetch" href="/boke/assets/js/65.2be08036.js"><link rel="prefetch" href="/boke/assets/js/66.1a6f0289.js"><link rel="prefetch" href="/boke/assets/js/67.956f7a73.js"><link rel="prefetch" href="/boke/assets/js/68.892a5356.js"><link rel="prefetch" href="/boke/assets/js/69.205124ae.js"><link rel="prefetch" href="/boke/assets/js/7.f50582b0.js"><link rel="prefetch" href="/boke/assets/js/70.780dd4ec.js"><link rel="prefetch" href="/boke/assets/js/71.a98b5098.js"><link rel="prefetch" href="/boke/assets/js/72.28d357d8.js"><link rel="prefetch" href="/boke/assets/js/73.26cde64e.js"><link rel="prefetch" href="/boke/assets/js/74.6e35323a.js"><link rel="prefetch" href="/boke/assets/js/75.9948bc3a.js"><link rel="prefetch" href="/boke/assets/js/76.5beb59e9.js"><link rel="prefetch" href="/boke/assets/js/77.a902129b.js"><link rel="prefetch" href="/boke/assets/js/78.f18d8898.js"><link rel="prefetch" href="/boke/assets/js/79.37c30cd9.js"><link rel="prefetch" href="/boke/assets/js/8.42beff4b.js"><link rel="prefetch" href="/boke/assets/js/80.74c087dd.js"><link rel="prefetch" href="/boke/assets/js/81.fc6161e9.js"><link rel="prefetch" href="/boke/assets/js/82.bda223d6.js"><link rel="prefetch" href="/boke/assets/js/83.6d096871.js"><link rel="prefetch" href="/boke/assets/js/85.31cf8a20.js"><link rel="prefetch" href="/boke/assets/js/86.4a27c335.js"><link rel="prefetch" href="/boke/assets/js/87.99afc9b6.js"><link rel="prefetch" href="/boke/assets/js/88.43c7707d.js"><link rel="prefetch" href="/boke/assets/js/89.7ee01670.js"><link rel="prefetch" href="/boke/assets/js/9.977ccbe2.js"><link rel="prefetch" href="/boke/assets/js/90.e03d9151.js"><link rel="prefetch" href="/boke/assets/js/91.2a96bacf.js"><link rel="prefetch" href="/boke/assets/js/92.f61fc5ec.js"><link rel="prefetch" href="/boke/assets/js/93.40a17799.js">
    <link rel="stylesheet" href="/boke/assets/css/0.styles.dd81ba30.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/boke/" class="home-link router-link-active"><img src="/boke/img/hero.jpg" alt="comelong blog" class="logo"> <span class="site-name can-hide">comelong blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/boke/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/boke/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/pages/712869/" class="nav-link">html5</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/b349c2/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/712848/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/658702/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/5d463fbdb172d43b/" class="nav-link">react</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/boke/back/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/pages/fbb16b/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/0a83b083bdf257cb/" class="nav-link">PHP</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/boke/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/boke/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/boke/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/boke/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统-网络-浏览器" class="dropdown-title"><a href="/boke/browser/" class="link-title">操作系统-网络-浏览器</a> <span class="title" style="display:none;">操作系统-网络-浏览器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/pages/530c2b/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/55b8a4/" aria-current="page" class="nav-link router-link-exact-active router-link-active">浏览器</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/77d83b/" class="nav-link">操作系统</a></li></ul></div></div><div class="nav-item"><a href="/boke/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/boke/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/boke/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/boke/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/mjlxiaoma" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/hero.jpg"> <div class="blogger-info"><h3>comelong</h3> <span>永远相信技术的力量</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/boke/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/boke/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/pages/712869/" class="nav-link">html5</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/b349c2/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/712848/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/658702/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/5d463fbdb172d43b/" class="nav-link">react</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/boke/back/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/pages/fbb16b/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/0a83b083bdf257cb/" class="nav-link">PHP</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/boke/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/boke/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/boke/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/boke/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统-网络-浏览器" class="dropdown-title"><a href="/boke/browser/" class="link-title">操作系统-网络-浏览器</a> <span class="title" style="display:none;">操作系统-网络-浏览器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/pages/530c2b/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/55b8a4/" aria-current="page" class="nav-link router-link-exact-active router-link-active">浏览器</a></li><li class="dropdown-item"><!----> <a href="/boke/pages/77d83b/" class="nav-link">操作系统</a></li></ul></div></div><div class="nav-item"><a href="/boke/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/boke/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boke/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/boke/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/boke/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/mjlxiaoma" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>浏览器</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/boke/pages/55b8a4/" aria-current="page" class="active sidebar-link">事件循环</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#相关推荐" class="sidebar-link">相关推荐</a></li><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#什么是事件循环" class="sidebar-link">什么是事件循环</a></li><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#任务的处理" class="sidebar-link">任务的处理</a></li><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#单线程处理安排好的任务" class="sidebar-link">单线程处理安排好的任务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#错误机制-出现问题" class="sidebar-link">错误机制（出现问题）</a></li><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#引入循环机制" class="sidebar-link">引入循环机制</a></li><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#安全退出" class="sidebar-link">安全退出</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#处理其它线程发送的任务" class="sidebar-link">处理其它线程发送的任务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#引入消息队列" class="sidebar-link">引入消息队列</a></li><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#消息队列中的任务类型" class="sidebar-link">消息队列中的任务类型</a></li><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#引入微任务" class="sidebar-link">引入微任务</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#事件循环总结" class="sidebar-link">事件循环总结</a></li><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#处理其它进程发送的任务" class="sidebar-link">处理其它进程发送的任务</a></li><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#消息队列和事件循环小结" class="sidebar-link">消息队列和事件循环小结</a></li><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#宏任务微任务" class="sidebar-link">宏任务微任务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#宏任务" class="sidebar-link">宏任务</a></li><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#settimeout" class="sidebar-link">setTimeout</a></li><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#宏任务不足点-或者问为什么不能只用宏任务" class="sidebar-link">宏任务不足点（或者问为什么不能只用宏任务）</a></li><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#微任务" class="sidebar-link">微任务</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#宏任务微任务总结-宏任务与微任务的关系" class="sidebar-link">宏任务微任务总结（宏任务与微任务的关系）</a></li><li class="sidebar-sub-header level2"><a href="/boke/pages/55b8a4/#例题巩固" class="sidebar-link">例题巩固</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#例题-1" class="sidebar-link">例题 1</a></li><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#例题-2" class="sidebar-link">例题 2</a></li><li class="sidebar-sub-header level3"><a href="/boke/pages/55b8a4/#例题-3" class="sidebar-link">例题 3</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/boke/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/boke/categories/?category=%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E7%BD%91%E8%B7%AF-%E6%B5%8F%E8%A7%88%E5%99%A8" title="分类" data-v-06225672>操作系统-网路-浏览器</a></li><li data-v-06225672><a href="/boke/categories/?category=%E6%B5%8F%E8%A7%88%E5%99%A8" title="分类" data-v-06225672>浏览器</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/mjlxiaoma" target="_blank" title="作者" class="beLink" data-v-06225672>comelong</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-04-30</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">事件循环<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="相关推荐"><a href="#相关推荐" class="header-anchor">#</a> 相关推荐</h2> <ul><li><a href="http://latentflip.com/loupe" target="_blank" rel="noopener noreferrer">Loupe 可视化工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：这是一个可视化的工具，能够帮助了解 js 的调用栈、事件循环、回调队列之间的调用关系等等的工具，帮助我们了解代码的执行情况。</li></ul> <p>下面是两个我觉得讲的比较好的视频推荐：</p> <ul><li><a href="https://www.youtube.com/watch?v=cCOL7MC4Pl0&amp;t=1592s" target="_blank" rel="noopener noreferrer">What the heck is the event loop anyway? | Philip Roberts | JSConf EU<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ" target="_blank" rel="noopener noreferrer">Jake Archibald: In The Loop - JSConf.Asia<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li></ul> <h2 id="什么是事件循环"><a href="#什么是事件循环" class="header-anchor">#</a> 什么是事件循环</h2> <p>为了协调事件、用户交互、脚本、UI 渲染、网络请求，用户代理必须使用 事件循环机制（Event Loop）。</p> <p>这种事件循环机制是由 JavaScript 的宿主环境来实现的，在浏览器运行环境中由浏览器内核引擎实现，而在 NodeJS 中则由 libuv 引擎实现。</p> <p>主线程运行时候，产生堆（Heap）和栈（Stack），栈中的代码调用各种外部 API，它们在任务队列中加入各种事件。只要栈中的代码执行完毕，主线程就会通过事件循环机制读取任务队列，依次执行那些事件所对应的回调函数。</p> <p><strong>运行机制：</strong></p> <ul><li>所有同步任务都在主线程上执行，形成一个 执行栈（Execution Context Stack）</li> <li>主线程之外，还存在一个 任务队列（Task Queue）。只要异步任务有了运行结果，就在 任务队列 之中放置一个事件</li> <li>一旦 执行栈 中的所有同步任务执行完毕，系统就会读取 任务队列，看看里面有哪些待执行事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行</li> <li>主线程不断重复上面的第三步</li></ul> <h2 id="任务的处理"><a href="#任务的处理" class="header-anchor">#</a> 任务的处理</h2> <p>为了能更好的理解，我们来搞个场景，搞几个任务来看怎么安排：比如在大学里面我们会举行班级活动，假设是班主任要求举行一次关于 职业规划与梦想相关的主题班会，而班长就会和班委们集思广益一起探讨相关任务。</p> <ul><li>任务 1：确定主题名称 我们的征途是星辰大海</li> <li>任务 2：写好活动策划书，班委各司其职</li> <li>任务 3：采购物资与班会地点安排</li> <li>任务 4：进行复盘总结</li></ul> <p>围绕这几个任务，看看是怎么处理的吧~</p> <h2 id="单线程处理安排好的任务"><a href="#单线程处理安排好的任务" class="header-anchor">#</a> 单线程处理安排好的任务</h2> <p>单线程处理任务，就类似于：班主任提出需求，线程开始，各班委分配好任务，将任务按照顺序依次执行，等所有任务都执行完，班会结束，线程主动退出。整个流程如下图所示：</p> <p><img src="https://liaoyio.github.io/notes/assets/eventloop.fb38e1df.png" alt="img"></p> <h3 id="错误机制-出现问题"><a href="#错误机制-出现问题" class="header-anchor">#</a> 错误机制（出现问题）</h3> <p>怎么样会出现问题呢？主要出现在班委分配任务上，并不是班主任一提出要求，就能把任务安排的好，可能在执行的过程中又提出新的任务了对吧，那就不好办了。。。</p> <p>怎么解决呢？<code>引入循环机制</code></p> <h3 id="引入循环机制"><a href="#引入循环机制" class="header-anchor">#</a> 引入循环机制</h3> <p>这个机制就是来解决：<strong>要想在线程运行过程中，能接收并执行新的任务</strong>。</p> <p>那较为简单的实现，我们加一个<code>for</code>循环不就好了？这样线程就能一直循环执行了，如下图：</p> <p><img src="https://liaoyio.github.io/notes/assets/eventloop02.5f96ccbc.png" alt="img"></p> <h3 id="安全退出"><a href="#安全退出" class="header-anchor">#</a> 安全退出</h3> <p>当确定要退出当前页面的时候，页面主线程会设置一个退出标志变量，在执行完一个任务之后，判断是否有设置退出标志，来判断时候终止当前所有任务，退出线程。</p> <h2 id="处理其它线程发送的任务"><a href="#处理其它线程发送的任务" class="header-anchor">#</a> 处理其它线程发送的任务</h2> <p>还是这个场景，我们再扩展一下，我们上一节中说的都是【单线程】，也就是班委组织内部（主线程）的任务处理，现实情况往往可能存在于其它非班委同学也想参与，也提出任务安排，那怎么解决呢？</p> <p>我们以 IO 线程为例，看看是怎么将消息发送给主线程的：</p> <p><img src="https://liaoyio.github.io/notes/assets/eventloop03.4aa2123e.png" alt="img"></p> <p>由上图可看到，主线程会频繁收到 IO 线程的一些任务，这里我稍微扩展一下：</p> <ul><li>接收到鼠标点击事件之后，渲染主线程就要开始执行<code>javascript</code> 脚本处理该点击事件。</li> <li>接受到资源加载完成的信息后，渲染进程要开始进行 DOM 解析等。</li></ul> <p>那每个任务不能你来了就执行吧，一个不错的方法就是存起来，也就是下面要说的消息队列：</p> <h3 id="引入消息队列"><a href="#引入消息队列" class="header-anchor">#</a> 引入消息队列</h3> <p>消息队列是一种数据结构，可以存放要执行的任务，“先进先出”，也就是说新的任务添加到队尾，取任务在队头。就如图这样：</p> <p><img src="https://liaoyio.github.io/notes/assets/eventloop03.4aa2123e.png" alt="img"></p> <h3 id="消息队列中的任务类型"><a href="#消息队列中的任务类型" class="header-anchor">#</a> 消息队列中的任务类型</h3> <p>包含了很多内部消息类型，如输入事件（鼠标滚动、点击、移动）、微任务、文件读写、WebSocket、JavaScript 定时器等等。</p> <p>除此之外，消息队列中还包含了很多与页面相关的事件，如 JavaScript 执行、解析 DOM、样式计算、布局计算、CSS 动画等。</p> <p>以上这些事件都是在主线程中执行的，所以在编写 Web 应用时，你还需要衡量这些事件所占用的时长，并想办法解决单个任务占用主线程过久的问题。</p> <h3 id="引入微任务"><a href="#引入微任务" class="header-anchor">#</a> 引入微任务</h3> <p>也是鉴于消息队列的“先进先出”的数据结构，后加入的任务需要等待前面的任务执行完，才会被执行，所以有问题需要被解决：</p> <p>一个常见的场景就是 DOM 节点变化监听，这是一个典型的观察者模式。</p> <p>不过这样也有问题：</p> <ul><li>因为 DOM 操作很频繁，如果每次变化都直接调用相应的 JavaScript 接口，那这个当前的任务执行时间就会被拉长，从而降低执行效率。</li> <li>那我不直接执行，而是把这些 DOM 变化做成异步的消息时间，添加到消息队列的话，又会影响实时性。</li></ul> <p>总结：如果 DOM 发送变化，采用同步通知的方式会影响当前任务的执行效率，如果采用异步的方式，又会造成监控的实时性问题。</p> <p>针对这两个问题，<strong>微任务</strong>产生了。</p> <p>我们通常把在消息队列中的任务称为<code>宏任务</code>，每个<code>宏任务</code>中都包含了一个微任务队列，在执行<code>宏任务</code>过程中，如果有<code>微任务</code>（DOM 变化），那么就添加到<code>微任务</code>队列中，这样即不会影响<code>宏任务</code>的执行（解决执行效率问题），同时一个<code>宏任务</code>完成，渲染进程不着急执行下一个<code>宏任务</code>，而是执行当前<code>宏任务</code>的<code>微任务</code>（解决实时性问题）。</p> <blockquote><p>这小节只是说为什么引入微任务，后面章节我们再详细聊微任务</p></blockquote> <h2 id="事件循环总结"><a href="#事件循环总结" class="header-anchor">#</a> 事件循环总结</h2> <p>我们来总结一下上述几节讲的内容，汇总成一张图：</p> <p><img src="https://liaoyio.github.io/notes/assets/eventloop05.07832209.png" alt="img"></p> <h2 id="处理其它进程发送的任务"><a href="#处理其它进程发送的任务" class="header-anchor">#</a> 处理其它进程发送的任务</h2> <p>还是班级活动的场景，咱们再扩充一下呢？讲了线程和其它线程（班级内部）怎么处理，那进程（其它班级）之间呢。</p> <blockquote><p>请先理解上面的【处理其它线程发送的任务】，之后再来看这张图，就很好理解了！</p></blockquote> <p>这个比较简单，之间看图吧：</p> <p><img src="https://liaoyio.github.io/notes/assets/eventloop06.9d370299.png" alt="img"></p> <p>渲染进程（我们班级），里面有一个专门的 IO 线程（班级外交官），用来接收其它进程（专门接收其它班级消息）传过来的消息，接到的消息再通过【处理其它线程发送的任务】给到主线程。</p> <h2 id="消息队列和事件循环小结"><a href="#消息队列和事件循环小结" class="header-anchor">#</a> 消息队列和事件循环小结</h2> <p>我们通过一个安排班会的场景例子带入，最后能总结以下这几点（这里就按准确一些的语言描述，避免和例子搞混）：</p> <ul><li>如果有一些确定好的任务，如主线程上确定好的任务，使用单线程按照顺序处理，只是第一版本的模型，显然很粗糙。</li> <li>在线程执行中接收并处理新的任务，引入事件循环（循环语句和事件系统），能满足单线程的接收处理任务，。这是第二版，还是不够。</li> <li>对于其它线程呢？我们引入消息队列，接收其它线程发送的任务。</li> <li>由于消息队列的机制并不灵活，于是引入微任务，能满足效率和实时性</li> <li>对于其它进程呢？不只是渲染进程一个进程做事啊，其它进程也会有任务发送过来，于是通过 IPC 将任务发送给 IO 线程，IO 线程再发送给主线程。</li></ul> <h2 id="宏任务微任务"><a href="#宏任务微任务" class="header-anchor">#</a> 宏任务微任务</h2> <p>我们通常把在消息队列中的任务称为<code>宏任务</code>，每个<code>宏任务</code>中都包含了一个微任务队列。</p> <h3 id="宏任务"><a href="#宏任务" class="header-anchor">#</a> 宏任务</h3> <p>页面中大多数任务都是在主线程上执行，包括：渲染事件（如解析 DOM、计算布局、绘制）、用户交互事件（如鼠标点击、滚动页面、放大缩小等）、JavaScript 脚本执行事件、网络请求完成、文件读写完成事件。</p> <p>简单来说就是以下这几种类型：</p> <ul><li>script(整体代码)</li> <li>setTimeout()</li> <li>setInterval()</li> <li>postMessage</li> <li>I/O</li> <li>UI 交互事件</li></ul> <h3 id="settimeout"><a href="#settimeout" class="header-anchor">#</a> setTimeout</h3> <p>讲到宏任务，总是离不开 setTimeout，简单来说它是一个定时器，用来指定某个函数在多少秒后执行。</p> <p>也是由于它<strong>延迟后执行</strong> 的特性，并且还需要在指定时间间隔执行，让原本的按顺序执行的消息队列无法满足，于是 Chrome 又搞了一个消息队列，专门来存放这些延迟执行的任务，一般我们叫延迟队列。</p> <p>他会等待主线程的顺序消息队列（为了和延迟消息队列做区分才这么叫）处理完，之后再到延迟队列拿里面的任务。这也就能解释，为什么尽管你设置了倒计时，然而实际上并不是在那个时间点立即被执行了。</p> <p>还有一个常考的点，就是<strong>setTimeout 的 this 指向</strong>，不符合直觉：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> myObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>myObj<span class="token punctuation">.</span>showName<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// 输出1</span>

<span class="token comment">// 可以通过bind改变this指向</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>myObj<span class="token punctuation">.</span><span class="token function">showName</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>myObj<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="宏任务不足点-或者问为什么不能只用宏任务"><a href="#宏任务不足点-或者问为什么不能只用宏任务" class="header-anchor">#</a> 宏任务不足点（或者问为什么不能只用宏任务）</h3> <p>页面的诸多任务，随时都有可能被添加到队列中，由系统操作，JavaScript 代码无法精准掌握任务在队列中的位置，很难掌控开始执行任务的时间。</p> <p>因此，对于一些高实时性的需求，由于宏任务的时间间隔不能精准控制，也就无法完成。</p> <p>于是有了微任务：</p> <h3 id="微任务"><a href="#微任务" class="header-anchor">#</a> 微任务</h3> <p>微任务就是一个需要异步执行的函数，执行时机是在主函数执行结束之后、当前宏任务结束之前。每个宏任务都关联着一个微任务队列。</p> <p><strong>微任务产生时机</strong></p> <ul><li>一种是使用 MutationObserver 监控某个 DOM 节点，然后通过 JavaScript 来修改这个节点等，当 DOM 节点发送变化，就会产生 DOM 变化记录的微任务。</li> <li>另一种是使用 Promise，当调用 Promise.resolve()或者 Promise.reject()方法是，也会产生微任务。</li></ul> <p><strong>微任务执行时机</strong></p> <p>当宏任务中 JavaScript 快执行完时，JavaScript 引擎会检查全局执行上下文中的微任务队列，然后按照顺序执行微任务。</p> <p>下图，描述了在执行 ParseHTML 这个宏任务的过程中，遇到 JavaScript 脚本，进入到 JavaScript 的执行环境，全局上下中包含了微任务列表（此时是空）。在 JavaScript 脚本继续执行的过程中，分别通过<code>Prpomise</code> 和 <code>removeChild</code>创建了两个微任务，并被添加到微任务队列：</p> <p><img src="https://liaoyio.github.io/notes/assets/eventloop07.952387fe.png" alt="img"></p> <p>接着到 JavaScript 脚本执行结束，准备退出全局执行上下文（也就是检查点）的过程：</p> <blockquote><p>WHATWG 把执行微任务的时间点称为检查点，检查点 JavaScript 引擎会检查微任务列表，并依次执行微任务，等微任务队列清空就退出全局执行上下文。</p></blockquote> <p><img src="https://liaoyio.github.io/notes/assets/eventloop08.3464932a.png" alt="img"></p> <h2 id="宏任务微任务总结-宏任务与微任务的关系"><a href="#宏任务微任务总结-宏任务与微任务的关系" class="header-anchor">#</a> 宏任务微任务总结（宏任务与微任务的关系）</h2> <ul><li>每个宏任务都会创建自己的微任务队列。微任务和宏任务是绑定的关系。</li> <li>微任务的执行时间会影响宏任务的时长。在宏任务中，微任务执行的时间比如说 1000 毫秒，这个时间也会被体现在宏任务中。</li> <li>在一个宏任务中，创建的微任务和用于回调的宏任务，由于产生的宏任务是要插到消息队列尾端的，需要在下一次的事件循环中才会被执行，而微任务是会在这次的事件循环执行，所以可以说，微任务都早于宏任务执行（后面会有经典的例子带你理解这段话）。</li></ul> <h2 id="例题巩固"><a href="#例题巩固" class="header-anchor">#</a> 例题巩固</h2> <p>由简单到复杂，话不多说直接开始：</p> <h3 id="例题-1"><a href="#例题-1" class="header-anchor">#</a> 例题 1</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>解析：</p> <p><img src="https://liaoyio.github.io/notes/assets/eventloop09.b91bcdb7.gif" alt="img">输出：</p> <p>输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>start
// 存宏任务和微任务，不会直接执行
end
// 栈空，执行微任务队列中的任务（经常会有坑，需要注意一下）
promise1
promise2
// 再下一轮eventloop执行宏任务
setTimeout
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="例题-2"><a href="#例题-2" class="header-anchor">#</a> 例题 2</h3> <p>这个是有 async promise 和 setTimeout 的</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>输出：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//从上往下看，定义的两个async函数先别管（执行再说）</span>
script start
<span class="token comment">//setTimeout放到宏任务队列</span>
<span class="token comment">// 执行了async1（异步函数）</span>
async1 start
<span class="token comment">// await 后面是 async2()，执行 async2（）异步函数</span>
async2
<span class="token comment">// await 后面的代码是微任务，放入微任务队列</span>
promise1
<span class="token comment">// .then()放到微任务队列</span>
script end
<span class="token comment">// 同步代码（同时也是宏任务）执行完成，接着执行微任务</span>
async1 end
promise2
<span class="token comment">//微任务队列清空，执行宏任务</span>
setTimeout
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="例题-3"><a href="#例题-3" class="header-anchor">#</a> 例题 3</h3> <p>我把这类题成为嵌套搞死人型题，执行代码会产生很多个宏任务，每个宏任务中又会产生微任务。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'children2'</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'children3'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'children4'</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'children5'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'children6'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'children7'</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>输出：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>start
<span class="token comment">// 遇到setTimeout，放入宏任务队列，称为宏任务1</span>
children4
<span class="token comment">// 遇到setTimeout，放入宏任务队列，称为宏任务2</span>
<span class="token comment">// 遇到.then  !!!不会被放到微任务队列!!!，因为resolve 是放到 setTimeout中执行的。</span>
<span class="token comment">// 执行完检查微任务队列是空的，于是执行宏任务1</span>
children2
<span class="token comment">// 把Promise.resolve().then放入微任务队列</span>
<span class="token comment">// 宏任务队列1空了，检查微任务队列，执行微任务</span>
children3
<span class="token comment">// 微任务清空，执行宏任务2</span>
children5
<span class="token comment">// .then放入微任务队列，宏任务2执行完，执行微任务</span>
children7
<span class="token comment">// setTimeout放入宏任务中，微任务执行完后执行</span>
children6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>只要思路清晰，脑子里多回顾几次，静下心来想一想，基本上就很清楚了！！！(希望大家能理解)</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/mjlxiaoma/edit/master/docs/06.操作系统-网路-浏览器/03.浏览器/01.事件循环.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/04/30, 08:34:25</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/boke/pages/530c2b/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">TCP</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/boke/pages/530c2b/" class="prev">TCP</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/boke/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/boke/pages/530c2b/"><div>
            TCP
            <!----></div></a> <span class="date">04-30</span></dt></dl><dl><dd>02</dd> <dt><a href="/boke/pages/77d83b/"><div>
            OS
            <!----></div></a> <span class="date">04-30</span></dt></dl><dl><dd>03</dd> <dt><a href="/boke/pages/d1f225/"><div>
            RESTful API
            <!----></div></a> <span class="date">07-30</span></dt></dl> <dl><dd></dd> <dt><a href="/boke/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1403029829@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/mjlxiaoma" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2025
    <span>comelong | <a href="https://github.com/mjlxiaoma" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/boke/assets/js/app.c21ee17f.js" defer></script><script src="/boke/assets/js/2.befd470a.js" defer></script><script src="/boke/assets/js/84.54d34310.js" defer></script>
  </body>
</html>
